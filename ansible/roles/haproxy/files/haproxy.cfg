global
    log /dev/log    local0
    log /dev/log    local1 notice
    chroot /var/lib/haproxy
    stats socket /run/haproxy/admin.sock mode 660 level admin
    stats timeout 30s
    user haproxy
    group haproxy
    daemon

defaults
    log     global
    option  redispatch
    option  dontlognull
    timeout connect 5000ms
    timeout client  50000ms
    timeout server  50000ms
    errorfile 400 /etc/haproxy/errors/400.http
    errorfile 403 /etc/haproxy/errors/403.http
    errorfile 408 /etc/haproxy/errors/408.http
    errorfile 500 /etc/haproxy/errors/500.http
    errorfile 502 /etc/haproxy/errors/502.http
    errorfile 503 /etc/haproxy/errors/503.http
    errorfile 504 /etc/haproxy/errors/504.http

frontend http_front
    bind *:80
    acl host_zulip hdr(host) -i zulip.healthnexus.online
    acl host_nextcloud hdr(host) -i nextcloud.healthnexus.online
    acl host_bigbluebutton hdr(host) -i bigbluebutton.healthnexus.online
    acl host_dokuwiki hdr(host) -i dokuwiki.healthnexus.online
    acl host_etherpad hdr(host) -i etherpad.healthnexus.online
    acl host_mumble hdr(host) -i mumble.healthnexus.online
    acl host_cryptpad hdr(host) -i cryptpad.healthnexus.online

    use_backend zulip_backend if host_zulip
    use_backend nextcloud_backend if host_nextcloud
    use_backend bigbluebutton_backend if host_bigbluebutton
    use_backend dokuwiki_backend if host_dokuwiki
    use_backend etherpad_backend if host_etherpad
    use_backend mumble_backend if host_mumble
    use_backend cryptpad_backend if host_cryptpad

backend zulip_backend
    server zulip_server 127.0.0.1:8001

backend nextcloud_backend
    server nextcloud_server 127.0.0.1:8002

backend bigbluebutton_backend
    server bigbluebutton_server 127.0.0.1:8003

backend dokuwiki_backend
    server dokuwiki_server 127.0.0.1:8004

backend etherpad_backend
    server etherpad_server 127.0.0.1:8005

backend mumble_backend
    server mumble_server 127.0.0.1:8006

backend cryptpad_backend
    server cryptpad_server 127.0.0.1:8007
